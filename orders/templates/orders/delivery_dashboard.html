{% extends 'users/base.html' %}
{% load static %}

{% block title %}Order Management - FoodOrdering{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="bg-light-green py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold text-dark mb-3">
                    {% if user.role == 'admin' %}
                        Admin - Order Management
                    {% else %}
                        Delivery Dashboard
                    {% endif %}
                </h1>
                <p class="lead text-muted mb-4">
                    {% if user.role == 'admin' %}
                        Welcome back, {{ user.username }}! Monitor all orders and delivery status across the platform.
                    {% else %}
                        Welcome back, {{ user.username }}! Manage your deliveries and track order status.
                    {% endif %}
                </p>
            </div>
            <div class="col-lg-4 text-center">
                <div class="bg-success rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 120px; height: 120px;">
                    <ion-icon name="bicycle-outline" size="large" class="text-white"></ion-icon>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Stats Section -->
<section class="py-5">
    <div class="container">
        <div class="row g-4 mb-5">
            <div class="col-md-3">
                <div class="card border-0 shadow-sm text-center">
                    <div class="card-body">
                        <div class="bg-warning rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <ion-icon name="time-outline" size="large" class="text-white"></ion-icon>
                        </div>
                        <h3 class="fw-bold text-dark">{{ orders.count }}</h3>
                        <p class="text-muted mb-0">
                            {% if user.role == 'admin' %}
                                Total Orders
                            {% else %}
                                Pending Orders
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="card border-0 shadow-sm text-center">
                    <div class="card-body">
                        <div class="bg-success rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <ion-icon name="checkmark-circle-outline" size="large" class="text-white"></ion-icon>
                        </div>
                        <h3 class="fw-bold text-dark">0</h3>
                        <p class="text-muted mb-0">Completed Today</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="card border-0 shadow-sm text-center">
                    <div class="card-body">
                        <div class="bg-info rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <ion-icon name="bicycle-outline" size="large" class="text-white"></ion-icon>
                        </div>
                        <h3 class="fw-bold text-dark">0</h3>
                        <p class="text-muted mb-0">In Transit</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="card border-0 shadow-sm text-center">
                    <div class="card-body">
                        <div class="bg-danger rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <ion-icon name="cash-outline" size="large" class="text-white"></ion-icon>
                        </div>
                        <h3 class="fw-bold text-dark">$0</h3>
                        <p class="text-muted mb-0">Earnings Today</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Orders Section -->
        {% if orders %}
            <div class="row">
                <div class="col-12">
                    <h2 class="fw-bold text-dark mb-4">
                        {% if user.role == 'admin' %}
                            All Orders
                        {% else %}
                            Available Orders
                        {% endif %}
                    </h2>
                </div>
            </div>
            
            <div class="row g-4">
                {% for order in orders %}
                    <div class="col-lg-6">
                        <div class="card h-100 border-0 shadow-sm order-card">
                            <div class="card-body p-4">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <h5 class="card-title fw-bold text-dark mb-0">Order #{{ order.id }}</h5>
                                    <span class="badge bg-{% if order.status == 'pending' %}warning{% elif order.status == 'confirmed' %}info{% elif order.status == 'delivered' %}success{% else %}danger{% endif %}">
                                        {{ order.get_status_display }}
                                    </span>
                                </div>
                                
                                <div class="row g-3 mb-4">
                                    <div class="col-6">
                                        <div class="d-flex align-items-center">
                                            <ion-icon name="person-outline" class="text-muted me-2"></ion-icon>
                                            <div>
                                                <small class="text-muted d-block">Customer</small>
                                                <strong>{{ order.user.username }}</strong>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="d-flex align-items-center">
                                            <ion-icon name="restaurant-outline" class="text-muted me-2"></ion-icon>
                                            <div>
                                                <small class="text-muted d-block">Restaurant</small>
                                                <strong>{{ order.restaurant.name|default:"N/A" }}</strong>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="d-flex align-items-center">
                                            <ion-icon name="cash-outline" class="text-muted me-2"></ion-icon>
                                            <div>
                                                <small class="text-muted d-block">Total Amount</small>
                                                <strong class="text-success">${{ order.total_amount }}</strong>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="d-flex align-items-center">
                                            <ion-icon name="time-outline" class="text-muted me-2"></ion-icon>
                                            <div>
                                                <small class="text-muted d-block">Order Time</small>
                                                <strong>{{ order.created_at|date:"H:i" }}</strong>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="d-flex gap-2">
                                    {% if user.role == 'admin' %}
                                        <button class="btn btn-primary btn-sm">
                                            <ion-icon name="eye-outline" class="me-1"></ion-icon>
                                            View Details
                                        </button>
                                        <button class="btn btn-success btn-sm">
                                            <ion-icon name="checkmark-outline" class="me-1"></ion-icon>
                                            Update Status
                                        </button>
                                    {% else %}
                                        <button class="btn btn-success btn-sm">
                                            <ion-icon name="checkmark-outline" class="me-1"></ion-icon>
                                            Accept Delivery
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm">
                                            <ion-icon name="call-outline" class="me-1"></ion-icon>
                                            Contact Customer
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="text-center py-5">
                        <div class="bg-light-green rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 120px; height: 120px;">
                            <ion-icon name="receipt-outline" size="large" class="text-success"></ion-icon>
                        </div>
                        <h3 class="fw-bold text-dark mb-3">No orders available</h3>
                        <p class="text-muted mb-4">
                            {% if user.role == 'admin' %}
                                There are currently no orders in the system.
                            {% else %}
                                There are currently no confirmed orders available for delivery.
                            {% endif %}
                        </p>
                        <a href="{% url 'users:profile' %}" class="btn btn-success">
                            <ion-icon name="arrow-back-outline" class="me-2"></ion-icon>
                            Back to Profile
                        </a>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</section>

<!-- Quick Actions Section -->
{% if orders %}
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <h2 class="fw-bold text-dark mb-4">Quick Actions</h2>
                <p class="text-muted mb-4">Manage orders efficiently</p>
            </div>
        </div>
        
        <div class="row g-4">
            <div class="col-md-3">
                <div class="card border-0 shadow-sm text-center h-100">
                    <div class="card-body">
                        <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <ion-icon name="refresh-outline" size="large" class="text-white"></ion-icon>
                        </div>
                        <h6 class="fw-bold">Refresh Orders</h6>
                        <p class="text-muted small">Check for new orders</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="card border-0 shadow-sm text-center h-100">
                    <div class="card-body">
                        <div class="bg-warning rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <ion-icon name="analytics-outline" size="large" class="text-white"></ion-icon>
                        </div>
                        <h6 class="fw-bold">View Analytics</h6>
                        <p class="text-muted small">Track performance</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="card border-0 shadow-sm text-center h-100">
                    <div class="card-body">
                        <div class="bg-info rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <ion-icon name="map-outline" size="large" class="text-white"></ion-icon>
                        </div>
                        <h6 class="fw-bold">Delivery Map</h6>
                        <p class="text-muted small">View delivery routes</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="card border-0 shadow-sm text-center h-100">
                    <div class="card-body">
                        <div class="bg-success rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <ion-icon name="settings-outline" size="large" class="text-white"></ion-icon>
                        </div>
                        <h6 class="fw-bold">Settings</h6>
                        <p class="text-muted small">Manage preferences</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<style>
.order-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.order-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.1) !important;
}
</style>
{% endblock %}